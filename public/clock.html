<html>
<head>


  <script   src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
  <script   src="./js/analog-clock.js"   crossorigin="anonymous"></script>

</head>

<body>
  <canvas id="spiral" width="500" height="500"></canvas>


  <p>Hello, world!</p>

  <script>

    var canvas2 = document.getElementById("spiral")
    var ctx2 = canvas2.getContext("2d")

    var cSpiral = document.createElement("canvas")
    cSpiral.width=500
    cSpiral.height=500
    var ctxSpiral = cSpiral.getContext("2d")

    var cHour = document.createElement("canvas")
    cHour.width=500
    cHour.height=500
    var ctxHour = cHour.getContext("2d")

    var drawDot = function(ctx, d, theta, phi) {
      var r = d * Math.sin(theta)
      ctx.save()
      ctx.beginPath()
      ctx.translate(ctx.canvas.width/2,ctx.canvas.height/2)
      ctx.rotate(phi)
      ctx.translate(0, -d)

      ctx.arc(0,0, r, 0, 2*Math.PI)
      ctx.fill()
      ctx.restore()
      console.log("d: "+d+", r: "+r)
    }

    var draw = function(d1, i)  {
      if (i>0) {
        var theta = 2*Math.PI/60
        var r1 = d1 * Math.sin(theta/2)
        var d2 = d1 * (1+Math.sin(theta/2))/(1-Math.sin(theta/2))
        var d3 = d2 * (1+Math.sin(theta/2))/(1-Math.sin(theta/2))

        ctxSpiral.fillStyle = (i == 1) ? "#333" : "#ccc"
        drawDot(ctxSpiral, d1, theta/2, -i*theta)

        ctxSpiral.fillStyle= "#ccc"
        drawDot(ctxSpiral, d3, theta/2, -i*theta)
        drawDot(ctxSpiral, d2, theta/2, -i*theta)

        draw(d1-.35, i-1)
      }
    }

    var drawHour = function(d1, i)  {
      if (i>0) {
        var theta = 2*Math.PI/12
        var r1 = d1 * Math.sin(theta/2)
        var d2 = d1 * (1+Math.sin(theta/2))/(1-Math.sin(theta/2))
        var d3 = d2 * (1+Math.sin(theta/2))/(1-Math.sin(theta/2))

        ctxHour.fillStyle = (i == 1) ? "#333" : "#ccc"
        drawDot(ctxHour, d1, theta/2, -i*theta)

        ctxHour.fillStyle= "#ccc"
        drawDot(ctxHour, d3, theta/2, -i*theta)
        drawDot(ctxHour, d2, theta/2, -i*theta)

        drawHour(d1-1.8, i-1)
      }
    }
    draw(200,60)
    drawHour(50,12)

    //mask the ring
    ctxSpiral.beginPath()
    ctxSpiral.globalCompositeOperation = "destination-in"
    ctxSpiral.lineWidth = 250*Math.sin(Math.PI/30)*2
    ctxSpiral.translate(cSpiral.width/2, cSpiral.height/2)
    ctxSpiral.arc(0,0,190,0, 2*Math.PI)
    ctxSpiral.stroke()


    ctxHour.beginPath()
    ctxHour.globalCompositeOperation = "destination-in"
    ctxHour.lineWidth = 100*Math.sin(Math.PI/12)*2
    ctxHour.translate(cHour.width/2, cHour.height/2)
    ctxHour.arc(0,0,40,0, 2*Math.PI)
    ctxHour.stroke()

    // ctx2.translate(ctx2.canvas.width/2, ctx2.canvas.height/2)
    // ctx2.rotate(Math.PI/30*40)
    // ctx2.translate(-ctx2.canvas.width/2, -ctx2.canvas.height/2)
    // ctx2.drawImage(cSpiral,0,0)

    var drawSpiral = function(timestamp) {
      var now = new Date()
      ctx2.clearRect(0,0,500,500)
      ctx2.save()
      ctx2.translate(ctx2.canvas.width/2, ctx2.canvas.height/2)
      ctx2.rotate(Math.floor(now.getSeconds()+2)*Math.PI/30)
      ctx2.translate(-ctx2.canvas.width/2, -ctx2.canvas.height/2)
      ctx2.drawImage(cSpiral,0,0)
      ctx2.restore()

      ctx2.save()
      ctx2.translate(ctx2.canvas.width/2, ctx2.canvas.height/2)
      ctx2.rotate(Math.floor(now.getMinutes()+2)*Math.PI/30)
      ctx2.translate(-ctx2.canvas.width/2, -ctx2.canvas.height/2)
      ctx2.drawImage(cSpiral,0,0, 500,500,100,100,300,300)
      ctx2.restore()

      ctx2.save()
      ctx2.translate(ctx2.canvas.width/2, ctx2.canvas.height/2)
      ctx2.rotate(Math.floor(now.getHours()%12+2)*Math.PI/6)
      ctx2.translate(-ctx2.canvas.width/2, -ctx2.canvas.height/2)
      ctx2.drawImage(cHour,0,0,500,500,50,50,400,400)
      ctx2.restore()

      console.log(now.getHours()%12);


      window.requestAnimationFrame(drawSpiral)
    }

    window.requestAnimationFrame(drawSpiral)







    </script>

</body>




</html>
